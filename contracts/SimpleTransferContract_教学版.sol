// SPDX-License-Identifier: MIT
// â†‘ è¿™æ˜¯ç‰ˆæƒå£°æ˜ï¼ŒMITæ˜¯ä¸€ç§å¼€æºåè®®ï¼Œè¡¨ç¤ºä»£ç å¯ä»¥è‡ªç”±ä½¿ç”¨

pragma solidity ^0.8.30;
// â†‘ æŒ‡å®šSolidityç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œ^è¡¨ç¤ºå…¼å®¹0.8.30åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆä½†å°äº0.9.0ï¼‰

/**
 * @title SimpleTransferContract - å­¦ä¹ ç‰ˆæ™ºèƒ½åˆçº¦
 * @dev è¿™æ˜¯ä¸€ä¸ªç”¨äºå­¦ä¹ çš„æ™ºèƒ½åˆçº¦ï¼Œæ¼”ç¤ºThe Graphäº‹ä»¶ç´¢å¼•
 * 
 * ğŸ“š æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ ï¼š
 * 1. æ™ºèƒ½åˆçº¦ = åœ¨åŒºå—é“¾ä¸Šè¿è¡Œçš„ç¨‹åº
 * 2. äº‹ä»¶ = åŒºå—é“¾ä¸Šçš„"æ—¥å¿—è®°å½•"ï¼Œå¯ä»¥è¢«å¤–éƒ¨ç¨‹åºç›‘å¬
 * 3. çŠ¶æ€å˜é‡ = æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„æ•°æ®
 * 4. å‡½æ•° = åˆçº¦ä¸­å¯ä»¥è¢«è°ƒç”¨çš„"æ–¹æ³•"
 */
contract SimpleTransferContract {
    
    // ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šäº‹ä»¶å®šä¹‰ ====================
    
    /**
     * @dev å®šä¹‰è½¬è´¦è®°å½•äº‹ä»¶
     * 
     * ğŸ¯ ä»€ä¹ˆæ˜¯äº‹ä»¶(Event)ï¼Ÿ
     * - äº‹ä»¶æ˜¯åŒºå—é“¾ä¸Šçš„"æ—¥å¿—"ï¼Œè®°å½•é‡è¦çš„æ“ä½œ
     * - å¤–éƒ¨ç¨‹åºï¼ˆå¦‚The Graphï¼‰å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶
     * - äº‹ä»¶æ¯”å­˜å‚¨æ•°æ®ä¾¿å®œå¾ˆå¤šï¼ˆçœgasè´¹ï¼‰
     * 
     * ğŸ” indexedå…³é”®å­—çš„ä½œç”¨ï¼š
     * - indexedå‚æ•°å¯ä»¥è¢«é«˜æ•ˆæŸ¥è¯¢å’Œç­›é€‰
     * - ä¾‹å¦‚ï¼šæŸ¥è¯¢æŸä¸ªåœ°å€å‘é€çš„æ‰€æœ‰è½¬è´¦è®°å½•
     * - æ¯ä¸ªäº‹ä»¶æœ€å¤šå¯ä»¥æœ‰3ä¸ªindexedå‚æ•°
     */
    event TransferRecord(
        address indexed from,      // å‘é€æ–¹åœ°å€ï¼ˆå¯æŸ¥è¯¢ç­›é€‰ï¼‰
        address indexed to,        // æ¥æ”¶æ–¹åœ°å€ï¼ˆå¯æŸ¥è¯¢ç­›é€‰ï¼‰  
        uint256 value,            // è½¬è´¦é‡‘é¢ï¼ˆä¸å¯ç­›é€‰ï¼Œä½†åŒ…å«åœ¨äº‹ä»¶æ•°æ®ä¸­ï¼‰
        uint256 timestamp,        // æ—¶é—´æˆ³ï¼ˆåŒºå—è¢«æŒ–å‡ºçš„æ—¶é—´ï¼‰
        string message,           // è½¬è´¦å¤‡æ³¨ä¿¡æ¯
        bytes32 recordId         // å”¯ä¸€è®°å½•ID
    );
    
    // ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šçŠ¶æ€å˜é‡ ====================
    
    /**
     * @dev çŠ¶æ€å˜é‡ - æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„æ•°æ®
     * 
     * ğŸ¦ ä»€ä¹ˆæ˜¯çŠ¶æ€å˜é‡ï¼Ÿ
     * - å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šï¼Œæ°¸ä¹…ä¿å­˜
     * - ä¿®æ”¹çŠ¶æ€å˜é‡éœ€è¦èŠ±è´¹gasè´¹
     * - publicå…³é”®å­—è‡ªåŠ¨ç”Ÿæˆgetterå‡½æ•°
     */
    
    // è®°å½•æ€»çš„è½¬è´¦è®°å½•æ•°é‡
    uint256 public totalRecords;
    // â†‘ uint256 = æ— ç¬¦å·256ä½æ•´æ•°ï¼ˆ0åˆ°2^256-1ï¼‰
    // â†‘ public = å¤–éƒ¨å¯ä»¥è¯»å–è¿™ä¸ªå˜é‡çš„å€¼
    
    // è®°å½•æ¯ä¸ªç”¨æˆ·çš„è½¬è´¦è®°å½•æ•°é‡
    mapping(address => uint256) public userRecordCount;
    // â†‘ mapping = é”®å€¼å¯¹æ˜ å°„ï¼Œç±»ä¼¼å­—å…¸/Map
    // â†‘ address = ä»¥å¤ªåŠåœ°å€ç±»å‹ï¼ˆ42ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰
    // â†‘ ä¾‹å¦‚ï¼šuserRecordCount[0x123...abc] = 5ï¼ˆè¡¨ç¤ºè¯¥åœ°å€æœ‰5æ¡è®°å½•ï¼‰
    
    // è®°å½•IDæ˜¯å¦å·²å­˜åœ¨ï¼ˆé˜²æ­¢é‡å¤ï¼‰
    mapping(bytes32 => bool) public recordExists;
    // â†‘ bytes32 = 32å­—èŠ‚çš„æ•°æ®ç±»å‹ï¼Œå¸¸ç”¨äºå­˜å‚¨å“ˆå¸Œå€¼
    // â†‘ bool = å¸ƒå°”ç±»å‹ï¼Œtrueæˆ–false
    
    // ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šè‡ªå®šä¹‰é”™è¯¯ ====================
    
    /**
     * @dev è‡ªå®šä¹‰é”™è¯¯ - Solidity 0.8.4+çš„æ–°ç‰¹æ€§
     * 
     * ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ï¼Ÿ
     * - æ¯”requireå­—ç¬¦ä¸²é”™è¯¯èŠ‚çœçº¦50%çš„gasè´¹
     * - é”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°å’Œæ ‡å‡†åŒ–
     * - æ”¯æŒå‚æ•°åŒ–é”™è¯¯ä¿¡æ¯
     */
    
    error InvalidRecipientAddress();  // æ— æ•ˆçš„æ¥æ”¶åœ°å€é”™è¯¯
    error InvalidValue();            // æ— æ•ˆçš„é‡‘é¢é”™è¯¯  
    error ArrayLengthMismatch();     // æ•°ç»„é•¿åº¦ä¸åŒ¹é…é”™è¯¯
    error RecordAlreadyExists();     // è®°å½•å·²å­˜åœ¨é”™è¯¯
    
    // ==================== ç¬¬å››éƒ¨åˆ†ï¼šä¸»è¦å‡½æ•° ====================
    
    /**
     * @dev è®°å½•è½¬è´¦ä¿¡æ¯çš„ä¸»å‡½æ•°
     * 
     * ğŸ“ å‡½æ•°è§£æï¼š
     * - public: å¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è¢«å†…éƒ¨è°ƒç”¨
     * - returns: å£°æ˜å‡½æ•°è¿”å›å€¼ç±»å‹
     * - memory: ä¸´æ—¶å­˜å‚¨ï¼Œå‡½æ•°æ‰§è¡Œå®Œå°±é”€æ¯ï¼ˆç›¸å¯¹ä¾¿å®œï¼‰
     * 
     * @param to æ¥æ”¶æ–¹åœ°å€
     * @param value è½¬è´¦é‡‘é¢ï¼ˆä»¥weiä¸ºå•ä½ï¼Œ1 ETH = 10^18 weiï¼‰
     * @param message è½¬è´¦å¤‡æ³¨ä¿¡æ¯
     * @return recordId è¿”å›ç”Ÿæˆçš„è®°å½•ID
     */
    function recordTransfer(
        address to,              // æ¥æ”¶æ–¹åœ°å€å‚æ•°
        uint256 value,           // è½¬è´¦é‡‘é¢å‚æ•°
        string memory message    // è½¬è´¦å¤‡æ³¨å‚æ•°
    ) public returns (bytes32 recordId) {
        
        // ---------- ç¬¬1æ­¥ï¼šè¾“å…¥éªŒè¯ ----------
        
        /**
         * ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥ - éªŒè¯è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§
         * 
         * address(0) = 0x0000...0000ï¼Œç©ºåœ°å€ï¼Œä¸èƒ½ä½œä¸ºæœ‰æ•ˆæ¥æ”¶æ–¹
         * revert = ç«‹å³åœæ­¢æ‰§è¡Œå¹¶å›æ»šæ‰€æœ‰çŠ¶æ€æ”¹å˜
         */
        if (to == address(0)) revert InvalidRecipientAddress();
        if (value == 0) revert InvalidValue();
        
        // ---------- ç¬¬2æ­¥ï¼šç”Ÿæˆå”¯ä¸€è®°å½•ID ----------
        
        /**
         * ğŸ” ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦
         * 
         * keccak256 = ä»¥å¤ªåŠä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ï¼Œè¾“å…¥ç›¸åŒåˆ™è¾“å‡ºç›¸åŒ
         * abi.encodePacked = å°†å¤šä¸ªå€¼æ‰“åŒ…æˆå­—èŠ‚æ•°ç»„
         * msg.sender = è°ƒç”¨æ­¤å‡½æ•°çš„åœ°å€ï¼ˆå½“å‰äº¤æ˜“å‘èµ·è€…ï¼‰
         * block.timestamp = å½“å‰åŒºå—çš„æ—¶é—´æˆ³
         * blockhash(block.number - 1) = å‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ï¼ˆå¢åŠ éšæœºæ€§ï¼‰
         */
        recordId = keccak256(
            abi.encodePacked(
                msg.sender,                    // å‘é€æ–¹åœ°å€
                to,                           // æ¥æ”¶æ–¹åœ°å€
                value,                        // è½¬è´¦é‡‘é¢
                block.timestamp,              // å½“å‰æ—¶é—´æˆ³
                totalRecords,                 // å½“å‰è®°å½•æ€»æ•°
                blockhash(block.number - 1)   // å‰ä¸€åŒºå—å“ˆå¸Œï¼ˆå¢åŠ éšæœºæ€§ï¼‰
            )
        );
        
        // æ£€æŸ¥è®°å½•IDæ˜¯å¦å·²å­˜åœ¨ï¼ˆé˜²æ­¢æå°æ¦‚ç‡çš„å“ˆå¸Œç¢°æ’ï¼‰
        if (recordExists[recordId]) revert RecordAlreadyExists();
        
        // ---------- ç¬¬3æ­¥ï¼šæ›´æ–°çŠ¶æ€å˜é‡ ----------
        
        /**
         * âš¡ uncheckedå— - Gasä¼˜åŒ–æŠ€å·§
         * 
         * æ­£å¸¸æƒ…å†µä¸‹ï¼ŒSolidityä¼šè‡ªåŠ¨æ£€æŸ¥æ•°å­¦è¿ç®—æ˜¯å¦æº¢å‡º
         * å½“æˆ‘ä»¬ç¡®å®šä¸ä¼šæº¢å‡ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨uncheckedè·³è¿‡æ£€æŸ¥ï¼ŒèŠ‚çœgas
         * 
         * è¿™é‡Œå®‰å…¨çš„åŸå› ï¼š
         * - totalRecordsä»0å¼€å§‹é€’å¢ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ä¸å¯èƒ½æº¢å‡ºuint256
         * - userRecordCountåŒç†
         */
        unchecked {
            totalRecords++;                    // æ€»è®°å½•æ•°+1
            userRecordCount[msg.sender]++;     // å‘é€æ–¹çš„è®°å½•æ•°+1
        }
        
        // æ ‡è®°è¿™ä¸ªè®°å½•IDå·²è¢«ä½¿ç”¨
        recordExists[recordId] = true;
        
        // ---------- ç¬¬4æ­¥ï¼šè§¦å‘äº‹ä»¶ ----------
        
        /**
         * ğŸ“¢ è§¦å‘äº‹ä»¶ - è¿™æ˜¯The Graphè¦ç›‘å¬çš„é‡ç‚¹ï¼
         * 
         * emit = è§¦å‘äº‹ä»¶çš„å…³é”®å­—
         * è¿™ä¸ªäº‹ä»¶ä¼šè¢«è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼ŒThe Graphå¯ä»¥ç›‘å¬å¹¶å»ºç«‹ç´¢å¼•
         * å¤–éƒ¨ç¨‹åºå¯ä»¥é€šè¿‡äº‹ä»¶æŸ¥è¯¢æ‰€æœ‰è½¬è´¦è®°å½•
         */
        emit TransferRecord(
            msg.sender,        // å‘é€æ–¹ï¼ˆå½“å‰è°ƒç”¨è€…ï¼‰
            to,               // æ¥æ”¶æ–¹
            value,            // è½¬è´¦é‡‘é¢
            block.timestamp,  // æ—¶é—´æˆ³
            message,          // å¤‡æ³¨ä¿¡æ¯
            recordId          // è®°å½•ID
        );
        
        // ---------- ç¬¬5æ­¥ï¼šè¿”å›ç»“æœ ----------
        
        // è¿”å›ç”Ÿæˆçš„è®°å½•IDï¼Œè°ƒç”¨æ–¹å¯ä»¥ç”¨æ¥è¿½è¸ªè¿™æ¬¡æ“ä½œ
        return recordId;
    }
    
    /**
     * @dev æ‰¹é‡è®°å½•è½¬è´¦ - æ¼”ç¤ºæ•°ç»„æ“ä½œå’Œå¾ªç¯
     * 
     * ğŸ“Š æ•°ç»„å‚æ•°è¯´æ˜ï¼š
     * - calldata: åªè¯»çš„å‚æ•°å­˜å‚¨ä½ç½®ï¼Œæ¯”memoryæ›´çœgas
     * - æ•°ç»„é•¿åº¦å¿…é¡»ä¸€è‡´ï¼šrecipients[0]å¯¹åº”values[0]å¯¹åº”messages[0]
     * 
     * @param recipients æ¥æ”¶æ–¹åœ°å€æ•°ç»„
     * @param values è½¬è´¦é‡‘é¢æ•°ç»„  
     * @param messages è½¬è´¦å¤‡æ³¨æ•°ç»„
     * @return recordIds è¿”å›æ‰€æœ‰ç”Ÿæˆçš„è®°å½•IDæ•°ç»„
     */
    function batchRecordTransfer(
        address[] calldata recipients,   // æ¥æ”¶æ–¹åœ°å€æ•°ç»„
        uint256[] calldata values,       // è½¬è´¦é‡‘é¢æ•°ç»„
        string[] calldata messages      // è½¬è´¦å¤‡æ³¨æ•°ç»„
    ) external returns (bytes32[] memory recordIds) {
        // â†‘ external: åªèƒ½è¢«å¤–éƒ¨è°ƒç”¨ï¼Œæ¯”publicç¨å¾®çœä¸€ç‚¹gas
        // â†‘ memory: è¿”å›å€¼åœ¨å†…å­˜ä¸­ä¸´æ—¶åˆ›å»º
        
        // è·å–æ•°ç»„é•¿åº¦
        uint256 length = recipients.length;
        
        // éªŒè¯æ‰€æœ‰æ•°ç»„é•¿åº¦å¿…é¡»ç›¸åŒ
        if (length != values.length || length != messages.length) {
            revert ArrayLengthMismatch();
        }
        
        // åˆ›å»ºè¿”å›ç»“æœæ•°ç»„
        recordIds = new bytes32[](length);
        // â†‘ new = åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œé•¿åº¦ä¸ºlength
        
        /**
         * ğŸ”„ å¾ªç¯å¤„ç†æ¯ä¸ªè½¬è´¦è®°å½•
         * 
         * forå¾ªç¯è¯­æ³•ï¼šfor(åˆå§‹åŒ–; æ¡ä»¶; é€’å¢)
         * è¿™é‡Œä½¿ç”¨uncheckedä¼˜åŒ–é€’å¢æ“ä½œ
         */
        for (uint256 i = 0; i < length;) {
            // è°ƒç”¨å•ä¸ªè½¬è´¦è®°å½•å‡½æ•°
            recordIds[i] = recordTransfer(
                recipients[i],    // ç¬¬iä¸ªæ¥æ”¶æ–¹
                values[i],       // ç¬¬iä¸ªé‡‘é¢
                messages[i]      // ç¬¬iä¸ªå¤‡æ³¨
            );
            
            /**
             * âš¡ å¾ªç¯ä¼˜åŒ–æŠ€å·§
             * 
             * æ­£å¸¸å†™æ³•ï¼ši++
             * ä¼˜åŒ–å†™æ³•ï¼šunchecked { i++; }
             * 
             * å› ä¸ºæˆ‘ä»¬çŸ¥é“iä¸ä¼šæº¢å‡ºï¼ˆå—lengthé™åˆ¶ï¼‰ï¼Œæ‰€ä»¥è·³è¿‡æº¢å‡ºæ£€æŸ¥
             */
            unchecked { 
                i++; 
            }
        }
        
        // è¿”å›æ‰€æœ‰è®°å½•ID
        return recordIds;
    }
    
    // ==================== ç¬¬äº”éƒ¨åˆ†ï¼šæŸ¥è¯¢å‡½æ•° ====================
    
    /**
     * @dev è·å–ç”¨æˆ·çš„è½¬è´¦è®°å½•æ•°
     * 
     * ğŸ” viewå‡½æ•°è¯´æ˜ï¼š
     * - view: åªè¯»å‡½æ•°ï¼Œä¸ä¿®æ”¹çŠ¶æ€ï¼Œä¸æ¶ˆè€—gasï¼ˆé™¤éåœ¨äº¤æ˜“ä¸­è°ƒç”¨ï¼‰
     * - external: åªèƒ½å¤–éƒ¨è°ƒç”¨
     * 
     * @param user è¦æŸ¥è¯¢çš„ç”¨æˆ·åœ°å€
     * @return count è¯¥ç”¨æˆ·çš„è®°å½•æ•°é‡
     */
    function getUserRecordCount(address user) external view returns (uint256 count) {
        return userRecordCount[user];
        // ç›´æ¥è¿”å›mappingä¸­å­˜å‚¨çš„å€¼
    }
    
    /**
     * @dev æ£€æŸ¥æŸä¸ªè®°å½•IDæ˜¯å¦å·²å­˜åœ¨
     * 
     * @param recordId è¦æ£€æŸ¥çš„è®°å½•ID
     * @return exists è®°å½•æ˜¯å¦å­˜åœ¨
     */
    function isRecordExists(bytes32 recordId) external view returns (bool exists) {
        return recordExists[recordId];
    }
    
    /**
     * @dev è·å–åˆçº¦çš„åŸºæœ¬ä¿¡æ¯
     * 
     * ğŸ“ˆ å¤šè¿”å›å€¼å‡½æ•°ï¼š
     * - å¯ä»¥è¿”å›å¤šä¸ªå€¼
     * - è°ƒç”¨æ—¶å¯ä»¥è§£æ„ï¼š(total, addr, block, time) = getContractInfo()
     * 
     * @return _totalRecords æ€»è®°å½•æ•°
     * @return _contractAddress åˆçº¦åœ°å€
     * @return _blockNumber å½“å‰åŒºå—å·
     * @return _blockTimestamp å½“å‰åŒºå—æ—¶é—´æˆ³
     */
    function getContractInfo() external view returns (
        uint256 _totalRecords,      // æ€»è®°å½•æ•°
        address _contractAddress,   // åˆçº¦åœ°å€
        uint256 _blockNumber,      // å½“å‰åŒºå—å·
        uint256 _blockTimestamp    // å½“å‰åŒºå—æ—¶é—´æˆ³
    ) {
        return (
            totalRecords,           // è¿”å›çŠ¶æ€å˜é‡
            address(this),         // address(this) = å½“å‰åˆçº¦åœ°å€
            block.number,          // å½“å‰åŒºå—å·
            block.timestamp        // å½“å‰åŒºå—æ—¶é—´æˆ³ï¼ˆUnixæ—¶é—´æˆ³ï¼‰
        );
    }
    
    /**
     * @dev è·å–åŒºå—é“¾ç›¸å…³ä¿¡æ¯ - å­¦ä¹ åŒºå—é“¾æ¦‚å¿µ
     * 
     * ğŸŒ åŒºå—é“¾åŸºç¡€æ¦‚å¿µï¼š
     * - block.number: å½“å‰åŒºå—å·ï¼ˆä»0å¼€å§‹é€’å¢ï¼‰
     * - blockhash(): æŒ‡å®šåŒºå—çš„å“ˆå¸Œå€¼
     * - block.prevrandao: å‰ä¸€ä¸ªåŒºå—çš„éšæœºæ•°ï¼ˆç”¨äºéšæœºæ€§ï¼‰
     * 
     * @return currentBlock å½“å‰åŒºå—å·
     * @return prevBlockHash å‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼
     * @return randomness éšæœºæ•°å€¼ï¼ˆåœ¨PoSä¸­ç”¨äºéšæœºæ€§ï¼‰
     */
    function getBlockInfo() external view returns (
        uint256 currentBlock,
        bytes32 prevBlockHash,  
        uint256 randomness
    ) {
        return (
            block.number,                    // å½“å‰åŒºå—å·
            blockhash(block.number - 1),    // å‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œ
            block.prevrandao                // éšæœºæ•°ï¼ˆ0.8.18+ç‰ˆæœ¬ç‰¹æ€§ï¼‰
        );
        // æ³¨æ„ï¼šblock.prevrandaoåœ¨0.8.18+ç‰ˆæœ¬ä¸­æ›¿ä»£äº†block.difficulty
    }
    
    // ==================== ç¬¬å…­éƒ¨åˆ†ï¼šå­¦ä¹ æ€»ç»“ ====================
    
    /**
     * ğŸ“ é€šè¿‡è¿™ä¸ªåˆçº¦ï¼Œæ‚¨å­¦åˆ°äº†ï¼š
     * 
     * 1. **åŸºæœ¬è¯­æ³•**ï¼š
     *    - pragma, contract, function, mapping, array
     *    - public, private, external, view
     *    - memory, storage, calldata
     * 
     * 2. **æ•°æ®ç±»å‹**ï¼š
     *    - address: ä»¥å¤ªåŠåœ°å€
     *    - uint256: æ— ç¬¦å·æ•´æ•°
     *    - bytes32: 32å­—èŠ‚æ•°æ®
     *    - bool: å¸ƒå°”å€¼
     *    - string: å­—ç¬¦ä¸²
     *    - mapping: é”®å€¼å¯¹æ˜ å°„
     * 
     * 3. **é‡è¦æ¦‚å¿µ**ï¼š
     *    - äº‹ä»¶(Events): åŒºå—é“¾æ—¥å¿—
     *    - çŠ¶æ€å˜é‡: æ°¸ä¹…å­˜å‚¨
     *    - Gasä¼˜åŒ–: unchecked, custom errors
     *    - å®‰å…¨æ£€æŸ¥: è¾“å…¥éªŒè¯, æº¢å‡ºä¿æŠ¤
     * 
     * 4. **åŒºå—é“¾ç‰¹æ€§**ï¼š
     *    - msg.sender: äº¤æ˜“å‘èµ·è€…
     *    - block.timestamp: åŒºå—æ—¶é—´
     *    - block.number: åŒºå—å·
     *    - å“ˆå¸Œå‡½æ•°: keccak256
     * 
     * 5. **The Graphé›†æˆ**ï¼š
     *    - äº‹ä»¶æ˜¯æ•°æ®ç´¢å¼•çš„åŸºç¡€
     *    - indexedå‚æ•°æ”¯æŒé«˜æ•ˆæŸ¥è¯¢
     *    - åˆçº¦äº‹ä»¶ â†’ The Graph â†’ GraphQL API
     */
}