# ğŸ•¸ï¸ Web3 é’±åŒ…é›†æˆè¯¦è§£

> ğŸ¯ æœ¬æŒ‡å—æ·±å…¥è®²è§£å¦‚ä½•ä½¿ç”¨ Wagmi + Viem å®ç°å®Œæ•´çš„ Web3 é’±åŒ…é›†æˆåŠŸèƒ½

## ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© Wagmi?

### ä¼ ç»Ÿæ–¹å¼ vs Wagmi
| å¯¹æ¯”ç»´åº¦ | ä¼ ç»Ÿ Web3.js/Ethers.js | ç°ä»£ Wagmi |
|----------|-------------------------|-------------|
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ï¼Œéœ€è¦ç†è§£åº•å±‚ç»†èŠ‚ | å¹³ç¼“ï¼ŒReact Hooks é£æ ¼ |
| **ç±»å‹å®‰å…¨** | éœ€è¦æ‰‹åŠ¨å®šä¹‰ç±»å‹ | å†…ç½® TypeScript æ”¯æŒ |
| **çŠ¶æ€ç®¡ç†** | æ‰‹åŠ¨ç®¡ç†è¿æ¥çŠ¶æ€ | è‡ªåŠ¨çŠ¶æ€ç®¡ç†å’ŒåŒæ­¥ |
| **é”™è¯¯å¤„ç†** | å¤æ‚çš„é”™è¯¯æ•è· | ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ |
| **ä»£ç é‡** | å¤§é‡æ ·æ¿ä»£ç  | ç®€æ´çš„ Hook è°ƒç”¨ |

### Wagmi æ ¸å¿ƒä¼˜åŠ¿
- ğŸª **React Hooks**: å®Œç¾èå…¥ React ç”Ÿæ€
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**: å…¨ç¨‹ TypeScript ç±»å‹ä¿æŠ¤  
- ğŸ”„ **è‡ªåŠ¨åŒæ­¥**: çŠ¶æ€å˜åŒ–è‡ªåŠ¨æ›´æ–°UI
- ğŸ§© **æ¨¡å—åŒ–**: æŒ‰éœ€å¯¼å…¥ï¼Œå‡å°‘åŒ…ä½“ç§¯
- ğŸŒ **å¤šé“¾æ”¯æŒ**: è½»æ¾åˆ‡æ¢ä¸åŒåŒºå—é“¾ç½‘ç»œ

## ğŸ—ï¸ æ¶æ„è®¾è®¡è§£æ

### æ•´ä½“æ¶æ„å›¾
```mermaid
graph TB
    A[React ç»„ä»¶] --> B[Wagmi Hooks]
    B --> C[Wagmi Config]
    C --> D[Connectors è¿æ¥å™¨]
    C --> E[Chains åŒºå—é“¾]
    C --> F[Transports ä¼ è¾“å±‚]
    
    D --> G[MetaMask]
    D --> H[Injected Wallet]
    
    E --> I[Sepolia Testnet]
    
    F --> J[RPC Provider]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5  
    style C fill:#fff3e0
```

### æ•°æ®æµå‘åˆ†æ
1. **ç”¨æˆ·æ“ä½œ** â†’ React ç»„ä»¶äº‹ä»¶è§¦å‘
2. **Hook è°ƒç”¨** â†’ Wagmi Hook å¤„ç†ä¸šåŠ¡é€»è¾‘
3. **é…ç½®æŸ¥è¯¢** â†’ ä» wagmiConfig è·å–ç½‘ç»œå’Œé’±åŒ…ä¿¡æ¯
4. **é’±åŒ…äº¤äº’** â†’ é€šè¿‡ Connector ä¸é’±åŒ…æ’ä»¶é€šä¿¡
5. **ç½‘ç»œè¯·æ±‚** â†’ Transport å±‚å‘é€ RPC è¯·æ±‚
6. **çŠ¶æ€æ›´æ–°** â†’ Hook è¿”å›æœ€æ–°çŠ¶æ€ï¼Œç»„ä»¶è‡ªåŠ¨é‡æ¸²æŸ“

## âš™ï¸ é…ç½®æ–‡ä»¶æ·±åº¦è§£æ

### wagmi.ts å®Œæ•´é…ç½®

```typescript
/**
 * Wagmi é…ç½®æ–‡ä»¶ - Web3 é’±åŒ…è¿æ¥å’ŒåŒºå—é“¾äº¤äº’é…ç½®
 * 
 * ğŸ—ï¸ é…ç½®ç»“æ„è¯´æ˜:
 * - chains: æ”¯æŒçš„åŒºå—é“¾ç½‘ç»œåˆ—è¡¨
 * - connectors: æ”¯æŒçš„é’±åŒ…è¿æ¥å™¨
 * - transports: RPC ä¼ è¾“é…ç½®
 */

import { createConfig, http } from 'wagmi'
import { sepolia } from 'wagmi/chains'
import { injected, metaMask } from 'wagmi/connectors'

export const wagmiConfig = createConfig({
  // ğŸŒ åŒºå—é“¾ç½‘ç»œé…ç½®
  chains: [sepolia],
  
  // ğŸ”Œ é’±åŒ…è¿æ¥å™¨é…ç½®
  connectors: [
    injected(),    // é€šç”¨æ³¨å…¥å¼é’±åŒ…è¿æ¥å™¨
    metaMask(),    // ä¸“ç”¨ MetaMask è¿æ¥å™¨
  ],
  
  // ğŸŒ RPC ä¼ è¾“é…ç½®  
  transports: {
    [sepolia.id]: http('https://ethereum-sepolia-rpc.publicnode.com'),
  },
})

// ğŸ“Š å¯¼å‡ºé“¾ ID ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
export const SEPOLIA_CHAIN_ID = sepolia.id;
```

### é…ç½®è¯¦ç»†è¯´æ˜

#### 1. Chains é…ç½®
```typescript
// Sepolia æµ‹è¯•ç½‘é…ç½®è¯¦æƒ…
const sepolia = {
  id: 11155111,                    // é“¾ ID
  name: 'Sepolia',                 // ç½‘ç»œåç§°
  nativeCurrency: {                // åŸç”Ÿä»£å¸ä¿¡æ¯
    name: 'Sepolia Ether',
    symbol: 'ETH', 
    decimals: 18
  },
  rpcUrls: {                       // RPC èŠ‚ç‚¹åˆ—è¡¨
    default: { http: ['https://sepolia.infura.io/v3/...'] },
    public: { http: ['https://ethereum-sepolia-rpc.publicnode.com'] }
  },
  blockExplorers: {                // åŒºå—æµè§ˆå™¨
    default: { 
      name: 'Etherscan',
      url: 'https://sepolia.etherscan.io'
    }
  }
}
```

#### 2. Connectors è¿æ¥å™¨è¯¦è§£
```typescript
// ğŸ”Œ æ³¨å…¥å¼é’±åŒ…è¿æ¥å™¨
injected({
  // è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨ä¸­çš„é’±åŒ…
  // æ”¯æŒ: MetaMask, Coinbase Wallet, Trust Wallet ç­‰
})

// ğŸ¦Š ä¸“ç”¨ MetaMask è¿æ¥å™¨
metaMask({
  // ä¸“é—¨ä¸º MetaMask ä¼˜åŒ–
  // æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ
})

// ğŸŒ WalletConnect è¿æ¥å™¨ (å¯é€‰)
walletConnect({
  projectId: 'your-walletconnect-project-id',
  // æ”¯æŒç§»åŠ¨ç«¯é’±åŒ…è¿æ¥
})
```

#### 3. Transports ä¼ è¾“å±‚é…ç½®
```typescript
// ğŸš€ HTTP ä¼ è¾“é…ç½®
http('https://ethereum-sepolia-rpc.publicnode.com', {
  // ä¼ è¾“é…ç½®é€‰é¡¹
  batch: true,        // æ‰¹é‡è¯·æ±‚ä¼˜åŒ–
  fetchOptions: {     // Fetch é€‰é¡¹
    timeout: 10000,   // è¶…æ—¶æ—¶é—´
  },
  retryCount: 3,      // é‡è¯•æ¬¡æ•°
  retryDelay: 1000,   // é‡è¯•é—´éš”
})
```

## ğŸª æ ¸å¿ƒ Hooks è¯¦è§£

### 1. useAccount - è´¦æˆ·ç®¡ç†

```typescript
/**
 * useAccount Hook å®Œæ•´åŠŸèƒ½
 * 
 * ğŸ” è¿”å›å€¼è§£æ:
 * - address: å½“å‰è¿æ¥çš„é’±åŒ…åœ°å€
 * - isConnected: è¿æ¥çŠ¶æ€å¸ƒå°”å€¼
 * - isConnecting: æ­£åœ¨è¿æ¥çŠ¶æ€
 * - isDisconnected: æ–­å¼€è¿æ¥çŠ¶æ€
 * - status: è¿æ¥çŠ¶æ€æšä¸¾
 */

const AccountExample = () => {
  const { 
    address,           // é’±åŒ…åœ°å€ (0x...)
    isConnected,       // æ˜¯å¦å·²è¿æ¥
    isConnecting,      // æ­£åœ¨è¿æ¥ä¸­
    isDisconnected,    // å·²æ–­å¼€è¿æ¥
    status             // è¯¦ç»†çŠ¶æ€: 'connecting' | 'connected' | 'disconnected'
  } = useAccount()

  // ğŸ¯ å®é™…åº”ç”¨åœºæ™¯
  if (isConnecting) return <div>è¿æ¥é’±åŒ…ä¸­...</div>
  if (isDisconnected) return <div>è¯·è¿æ¥é’±åŒ…</div>
  if (isConnected) return <div>å·²è¿æ¥: {address}</div>
}
```

### 2. useConnect - é’±åŒ…è¿æ¥

```typescript
/**
 * useConnect Hook è¿æ¥ç®¡ç†
 * 
 * ğŸ”— è¿æ¥æµç¨‹:
 * 1. é€‰æ‹©è¿æ¥å™¨ (MetaMask, Injected ç­‰)
 * 2. è°ƒç”¨ connect å‡½æ•°
 * 3. é’±åŒ…å¼¹å‡ºæˆæƒç•Œé¢
 * 4. ç”¨æˆ·ç¡®è®¤è¿æ¥
 * 5. çŠ¶æ€è‡ªåŠ¨æ›´æ–°
 */

const ConnectExample = () => {
  const { 
    connect,           // è¿æ¥å‡½æ•°
    connectors,        // å¯ç”¨è¿æ¥å™¨åˆ—è¡¨
    isPending,         // è¿æ¥è¿›è¡Œä¸­çŠ¶æ€
    error              // è¿æ¥é”™è¯¯ä¿¡æ¯
  } = useConnect()

  return (
    <div>
      {connectors.map((connector) => (
        <button
          key={connector.id}
          onClick={() => connect({ connector })}
          disabled={isPending}
        >
          {isPending ? 'è¿æ¥ä¸­...' : `è¿æ¥ ${connector.name}`}
        </button>
      ))}
      {error && <div>è¿æ¥å¤±è´¥: {error.message}</div>}
    </div>
  )
}
```

### 3. useBalance - ä½™é¢æŸ¥è¯¢

```typescript
/**
 * useBalance Hook ä½™é¢ç®¡ç†
 * 
 * ğŸ’° åŠŸèƒ½ç‰¹æ€§:
 * - è‡ªåŠ¨æŸ¥è¯¢æŒ‡å®šåœ°å€ä½™é¢
 * - æ”¯æŒåŸç”Ÿä»£å¸å’Œ ERC20 ä»£å¸
 * - è‡ªåŠ¨æ ¼å¼åŒ–æ•°é‡å’Œç¬¦å·
 * - å®æ—¶æ›´æ–°ä½™é¢å˜åŒ–
 */

const BalanceExample = () => {
  const { address } = useAccount()
  
  const { 
    data: balance,     // ä½™é¢æ•°æ®å¯¹è±¡
    isLoading,         // åŠ è½½çŠ¶æ€
    error,             // é”™è¯¯ä¿¡æ¯
    refetch            // æ‰‹åŠ¨åˆ·æ–°å‡½æ•°
  } = useBalance({
    address: address,  // æŸ¥è¯¢åœ°å€
    // token: '0x...',  // å¯é€‰: ERC20 ä»£å¸åœ°å€
    // watch: true,     // å¯é€‰: ç›‘å¬ä½™é¢å˜åŒ–
  })

  if (isLoading) return <div>æŸ¥è¯¢ä½™é¢ä¸­...</div>
  if (error) return <div>æŸ¥è¯¢å¤±è´¥: {error.message}</div>

  return (
    <div>
      ä½™é¢: {balance?.formatted} {balance?.symbol}
      <button onClick={() => refetch()}>åˆ·æ–°</button>
    </div>
  )
}
```

### 4. useSendTransaction - äº¤æ˜“å‘é€

```typescript
/**
 * useSendTransaction Hook äº¤æ˜“ç®¡ç†
 * 
 * ğŸ’¸ äº¤æ˜“æµç¨‹:
 * 1. å‡†å¤‡äº¤æ˜“å‚æ•° (to, value, data)
 * 2. è°ƒç”¨ sendTransaction å‡½æ•°
 * 3. é’±åŒ…å¼¹å‡ºç­¾åç•Œé¢
 * 4. ç”¨æˆ·ç¡®è®¤å¹¶ç­¾å
 * 5. äº¤æ˜“æäº¤åˆ°ç½‘ç»œ
 * 6. è¿”å›äº¤æ˜“å“ˆå¸Œ
 */

const SendTransactionExample = () => {
  const { 
    sendTransaction,   // å‘é€äº¤æ˜“å‡½æ•°
    data: txHash,      // äº¤æ˜“å“ˆå¸Œ
    isPending,         // äº¤æ˜“æäº¤ä¸­
    error              // äº¤æ˜“é”™è¯¯
  } = useSendTransaction()

  const handleSend = async () => {
    try {
      await sendTransaction({
        to: '0x...',                    // æ¥æ”¶åœ°å€
        value: parseEther('0.1'),       // è½¬è´¦é‡‘é¢ (Wei)
        // data: '0x...',               // å¯é€‰: äº¤æ˜“æ•°æ®
        // gas: 21000n,                 // å¯é€‰: Gas é™åˆ¶
        // gasPrice: parseGwei('10'),   // å¯é€‰: Gas ä»·æ ¼
      })
    } catch (error) {
      console.error('äº¤æ˜“å¤±è´¥:', error)
    }
  }

  return (
    <div>
      <button onClick={handleSend} disabled={isPending}>
        {isPending ? 'å‘é€ä¸­...' : 'å‘é€äº¤æ˜“'}
      </button>
      {txHash && <div>äº¤æ˜“å“ˆå¸Œ: {txHash}</div>}
      {error && <div>äº¤æ˜“å¤±è´¥: {error.message}</div>}
    </div>
  )
}
```

### 5. useWaitForTransactionReceipt - äº¤æ˜“ç¡®è®¤

```typescript
/**
 * useWaitForTransactionReceipt Hook äº¤æ˜“ç¡®è®¤
 * 
 * â³ ç¡®è®¤æµç¨‹:
 * 1. äº¤æ˜“æäº¤åˆ°å†…å­˜æ± 
 * 2. çŸ¿å·¥æ‰“åŒ…åˆ°åŒºå—
 * 3. åŒºå—è¢«ç½‘ç»œç¡®è®¤
 * 4. Hook è¿”å›äº¤æ˜“æ”¶æ®
 */

const TransactionReceiptExample = () => {
  const [txHash, setTxHash] = useState('')
  
  const { 
    data: receipt,     // äº¤æ˜“æ”¶æ®
    isLoading,         // ç­‰å¾…ç¡®è®¤ä¸­
    isSuccess,         // äº¤æ˜“æˆåŠŸ
    error              // äº¤æ˜“å¤±è´¥
  } = useWaitForTransactionReceipt({
    hash: txHash as `0x${string}`,
    // confirmations: 1,  // å¯é€‰: ç¡®è®¤æ•°é‡
    // timeout: 60_000,   // å¯é€‰: è¶…æ—¶æ—¶é—´
  })

  if (isLoading) return <div>ç­‰å¾…äº¤æ˜“ç¡®è®¤...</div>
  if (error) return <div>äº¤æ˜“å¤±è´¥: {error.message}</div>
  if (isSuccess) return <div>äº¤æ˜“æˆåŠŸï¼Gas ä½¿ç”¨: {receipt?.gasUsed.toString()}</div>

  return null
}
```

## ğŸ¨ ç»„ä»¶é›†æˆå®è·µ

### WalletTransfer ç»„ä»¶æ·±åº¦åˆ†æ

```typescript
/**
 * WalletTransfer ç»„ä»¶æ¶æ„åˆ†æ
 * 
 * ğŸ—ï¸ ç»„ä»¶ç»“æ„:
 * WalletTransfer
 * â”œâ”€â”€ è¿æ¥çŠ¶æ€ç®¡ç†
 * â”œâ”€â”€ ä½™é¢æŸ¥è¯¢æ˜¾ç¤º  
 * â”œâ”€â”€ è½¬è´¦è¡¨å•å¤„ç†
 * â”œâ”€â”€ äº¤æ˜“çŠ¶æ€è·Ÿè¸ª
 * â””â”€â”€ é”™è¯¯å¤„ç†å±•ç¤º
 */

const WalletTransfer = ({ onTransactionSuccess }) => {
  // ğŸ”— é’±åŒ…è¿æ¥çŠ¶æ€
  const { address, isConnected } = useAccount()
  const { connect, connectors } = useConnect()
  const { disconnect } = useDisconnect()
  
  // ğŸ’° ä½™é¢æŸ¥è¯¢
  const { data: balance, isLoading: isLoadingBalance } = useBalance({
    address: address,
  })
  
  // ğŸ’¸ äº¤æ˜“å‘é€
  const { 
    sendTransaction, 
    data: txHash, 
    isPending: isTxPending, 
    error: txError 
  } = useSendTransaction()
  
  // â³ äº¤æ˜“ç¡®è®¤
  const { 
    isLoading: isConfirming, 
    isSuccess: isConfirmed,
    error: receiptError
  } = useWaitForTransactionReceipt({
    hash: txHash,
  })

  // ğŸ¯ æ ¸å¿ƒè½¬è´¦é€»è¾‘
  const handleTransfer = async () => {
    if (!toAddress || !amount || !address) return

    try {
      await sendTransaction({
        to: toAddress as `0x${string}`,
        value: parseEther(amount),
      })
    } catch (error) {
      console.error('Transfer error:', error)
    }
  }

  // âœ… æˆåŠŸå¤„ç†å‰¯ä½œç”¨
  useEffect(() => {
    if (isConfirmed && txHash) {
      onTransactionSuccess?.(txHash)  // é€šçŸ¥çˆ¶ç»„ä»¶
      // é‡ç½®è¡¨å•çŠ¶æ€
    }
  }, [isConfirmed, txHash, onTransactionSuccess])

  // ğŸ¨ UI æ¸²æŸ“é€»è¾‘
  return (
    <div>
      {/* é’±åŒ…è¿æ¥åŒºåŸŸ */}
      {!isConnected ? (
        <ConnectWalletSection />
      ) : (
        <ConnectedWalletInfo />
      )}
      
      {/* è½¬è´¦è¡¨å•åŒºåŸŸ */}
      {isConnected && (
        <TransferFormSection />
      )}
    </div>
  )
}
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

### å¸¸è§é”™è¯¯ç±»å‹å’Œå¤„ç†

```typescript
/**
 * Web3 é”™è¯¯å¤„ç†å®Œæ•´æŒ‡å—
 * 
 * ğŸš¨ å¸¸è§é”™è¯¯ç±»å‹:
 * - ç”¨æˆ·æ‹’ç»: User denied transaction signature
 * - ä½™é¢ä¸è¶³: Insufficient funds
 * - Gas ä¼°ç®—å¤±è´¥: Cannot estimate gas
 * - ç½‘ç»œé”™è¯¯: Network connection failed
 */

const ErrorHandlingExample = () => {
  const handleError = (error: Error) => {
    // ğŸ” é”™è¯¯ç±»å‹è¯†åˆ«
    if (error.message.includes('User denied')) {
      showNotification('ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“', 'warning')
    } else if (error.message.includes('insufficient funds')) {
      showNotification('è´¦æˆ·ä½™é¢ä¸è¶³', 'error')
    } else if (error.message.includes('gas')) {
      showNotification('Gas è´¹ç”¨ä¼°ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥äº¤æ˜“å‚æ•°', 'error')
    } else {
      showNotification(`äº¤æ˜“å¤±è´¥: ${error.message}`, 'error')
    }
    
    // ğŸ“Š é”™è¯¯ç»Ÿè®¡ä¸ŠæŠ¥
    reportError('transaction_error', {
      message: error.message,
      stack: error.stack,
      timestamp: new Date().toISOString()
    })
  }

  return (
    // UI ç»„ä»¶
  )
}
```

### ç½‘ç»œåˆ‡æ¢å¤„ç†

```typescript
/**
 * ç½‘ç»œåˆ‡æ¢å¤„ç†
 * 
 * ğŸŒ å¤„ç†åœºæ™¯:
 * - ç”¨æˆ·åœ¨é”™è¯¯ç½‘ç»œ
 * - éœ€è¦åˆ‡æ¢åˆ° Sepolia
 * - è‡ªåŠ¨åˆ‡æ¢å¤±è´¥æ—¶çš„æç¤º
 */

const NetworkSwitchExample = () => {
  const { chain } = useAccount()
  const { switchChain } = useSwitchChain()

  useEffect(() => {
    if (chain && chain.id !== SEPOLIA_CHAIN_ID) {
      // ğŸ”„ å°è¯•è‡ªåŠ¨åˆ‡æ¢ç½‘ç»œ
      switchChain({ chainId: SEPOLIA_CHAIN_ID })
        .catch(() => {
          // åˆ‡æ¢å¤±è´¥æ—¶çš„ç”¨æˆ·æç¤º
          showNotification('è¯·æ‰‹åŠ¨åˆ‡æ¢åˆ° Sepolia æµ‹è¯•ç½‘', 'warning')
        })
    }
  }, [chain, switchChain])

  if (chain?.id !== SEPOLIA_CHAIN_ID) {
    return (
      <div className="network-warning">
        âš ï¸ è¯·åˆ‡æ¢åˆ° Sepolia æµ‹è¯•ç½‘
        <button onClick={() => switchChain({ chainId: SEPOLIA_CHAIN_ID })}>
          åˆ‡æ¢ç½‘ç»œ
        </button>
      </div>
    )
  }

  return <div>ç½‘ç»œæ­£ç¡® âœ…</div>
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. åœ°å€éªŒè¯
```typescript
/**
 * ä»¥å¤ªåŠåœ°å€éªŒè¯
 */
const isValidAddress = (address: string): boolean => {
  // åŸºç¡€æ ¼å¼éªŒè¯
  if (!/^0x[a-fA-F0-9]{40}$/.test(address)) {
    return false
  }
  
  // æ ¡éªŒå’ŒéªŒè¯ (EIP-55)
  try {
    return getAddress(address) === address
  } catch {
    return false
  }
}
```

### 2. é‡‘é¢éªŒè¯
```typescript
/**
 * è½¬è´¦é‡‘é¢å®‰å…¨éªŒè¯
 */
const validateTransferAmount = (
  amount: string, 
  balance: bigint,
  maxAllowed: bigint = parseEther('10') // å•æ¬¡æœ€å¤§è½¬è´¦é™åˆ¶
): string | null => {
  try {
    const amountWei = parseEther(amount)
    
    if (amountWei <= 0n) {
      return 'è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº 0'
    }
    
    if (amountWei > balance) {
      return 'ä½™é¢ä¸è¶³'
    }
    
    if (amountWei > maxAllowed) {
      return 'å•æ¬¡è½¬è´¦é‡‘é¢è¿‡å¤§'
    }
    
    return null // éªŒè¯é€šè¿‡
  } catch {
    return 'é‡‘é¢æ ¼å¼é”™è¯¯'
  }
}
```

### 3. äº¤æ˜“ç›‘æ§
```typescript
/**
 * äº¤æ˜“çŠ¶æ€ç›‘æ§
 */
const useTransactionMonitor = (txHash: string) => {
  const [status, setStatus] = useState<'pending' | 'success' | 'failed'>('pending')
  
  useEffect(() => {
    if (!txHash) return
    
    // ç›‘æ§äº¤æ˜“çŠ¶æ€å˜åŒ–
    const monitorTransaction = async () => {
      try {
        const receipt = await waitForTransactionReceipt({
          hash: txHash,
          timeout: 300_000, // 5 åˆ†é’Ÿè¶…æ—¶
        })
        
        setStatus(receipt.status === 'success' ? 'success' : 'failed')
      } catch (error) {
        console.error('Transaction monitoring failed:', error)
        setStatus('failed')
      }
    }
    
    monitorTransaction()
  }, [txHash])
  
  return status
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. è¿æ¥çŠ¶æ€ç¼“å­˜
```typescript
/**
 * è¿æ¥çŠ¶æ€æŒä¹…åŒ–
 */
const usePersistedConnection = () => {
  const { isConnected } = useAccount()
  
  useEffect(() => {
    // ä¿å­˜è¿æ¥çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('wallet_connected', isConnected.toString())
  }, [isConnected])
  
  // é¡µé¢åŠ è½½æ—¶æ¢å¤è¿æ¥çŠ¶æ€
  useEffect(() => {
    const wasConnected = localStorage.getItem('wallet_connected') === 'true'
    if (wasConnected && !isConnected) {
      // å°è¯•è‡ªåŠ¨é‡è¿
      reconnect()
    }
  }, [])
}
```

### 2. æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
```typescript
/**
 * æ‰¹é‡ä½™é¢æŸ¥è¯¢
 */
const useMultipleBalances = (addresses: string[]) => {
  return useQuery({
    queryKey: ['balances', addresses],
    queryFn: async () => {
      // ä½¿ç”¨ multicall æ‰¹é‡æŸ¥è¯¢ä½™é¢
      const results = await readContracts({
        contracts: addresses.map(address => ({
          address: '0x...', // åŸç”Ÿä»£å¸æˆ–ä»£å¸åˆçº¦åœ°å€
          abi: balanceAbi,
          functionName: 'balanceOf',
          args: [address],
        })),
      })
      return results
    },
    staleTime: 30_000, // 30ç§’ç¼“å­˜
  })
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. Hook æµ‹è¯•
```typescript
/**
 * Wagmi Hook æµ‹è¯•ç¤ºä¾‹
 */
import { renderHook, waitFor } from '@testing-library/react'
import { useAccount } from 'wagmi'

const wrapper = ({ children }) => (
  <WagmiProvider config={testConfig}>
    {children}
  </WagmiProvider>
)

test('useAccount returns connected status', async () => {
  const { result } = renderHook(() => useAccount(), { wrapper })
  
  await waitFor(() => {
    expect(result.current.isConnected).toBe(true)
  })
})
```

### 2. ç»„ä»¶é›†æˆæµ‹è¯•
```typescript
/**
 * é’±åŒ…ç»„ä»¶é›†æˆæµ‹è¯•
 */
import { render, screen, fireEvent } from '@testing-library/react'
import WalletTransfer from './WalletTransfer'

test('displays connect button when wallet not connected', () => {
  render(<WalletTransfer />)
  
  expect(screen.getByText('è¿æ¥é’±åŒ…')).toBeInTheDocument()
})

test('shows transfer form when wallet connected', async () => {
  // Mock connected wallet
  mockUseAccount.mockReturnValue({
    isConnected: true,
    address: '0x123...'
  })
  
  render(<WalletTransfer />)
  
  expect(screen.getByText('å‘é€ ETH')).toBeInTheDocument()
})
```

## ğŸš€ éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡
```typescript
// .env.production
VITE_WALLETCONNECT_PROJECT_ID=your_project_id
VITE_RPC_URL=https://ethereum-sepolia-rpc.publicnode.com
VITE_ENABLE_TESTNET=false
```

### 2. æ„å»ºä¼˜åŒ–
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'wagmi': ['wagmi', 'viem'],
          'wallet': ['@rainbow-me/rainbowkit'],
        }
      }
    }
  }
})
```

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] é’±åŒ…è¿æ¥/æ–­å¼€åŠŸèƒ½æ­£å¸¸
- [ ] æ”¯æŒå¤šç§é’±åŒ…ç±»å‹ (MetaMask, Injected)
- [ ] ä½™é¢æŸ¥è¯¢å®æ—¶æ›´æ–°
- [ ] è½¬è´¦åŠŸèƒ½å®Œæ•´æµç¨‹
- [ ] äº¤æ˜“çŠ¶æ€æ­£ç¡®è·Ÿè¸ª
- [ ] é”™è¯¯å¤„ç†è¦†ç›–å…¨é¢

### ç”¨æˆ·ä½“éªŒ
- [ ] è¿æ¥çŠ¶æ€æ¸…æ™°æ˜¾ç¤º
- [ ] åŠ è½½çŠ¶æ€å‹å¥½æç¤º
- [ ] é”™è¯¯ä¿¡æ¯ç”¨æˆ·å¯ç†è§£
- [ ] äº¤æ˜“è¿›åº¦å®æ—¶åé¦ˆ
- [ ] è¡¨å•éªŒè¯åŠæ—¶å‡†ç¡®
- [ ] å“åº”å¼è®¾è®¡é€‚é…ç§»åŠ¨ç«¯

### å®‰å…¨æ€§
- [ ] åœ°å€æ ¼å¼ä¸¥æ ¼éªŒè¯
- [ ] è½¬è´¦é‡‘é¢å®‰å…¨æ£€æŸ¥
- [ ] ç½‘ç»œåˆ‡æ¢æ­£ç¡®å¤„ç†
- [ ] æ•æ„Ÿä¿¡æ¯ä¸åœ¨å®¢æˆ·ç«¯å­˜å‚¨
- [ ] äº¤æ˜“å‚æ•°äºŒæ¬¡ç¡®è®¤

---

ğŸ‰ **æ­å–œï¼** ä½ ç°åœ¨å·²ç»æŒæ¡äº†å®Œæ•´çš„ Web3 é’±åŒ…é›†æˆæŠ€æœ¯ï¼

ğŸ‘‰ **ä¸‹ä¸€æ­¥**: [The Graph æ•°æ®ç´¢å¼•è¯¦è§£](./05-TheGraphæ•°æ®ç´¢å¼•.md)

ğŸ’¡ **å®è·µå»ºè®®**: å»ºè®®åœ¨ MetaMask ä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•è´¦æˆ·ï¼Œè·å–ä¸€äº›æµ‹è¯• ETHï¼Œç„¶åå®é™…æ“ä½œæ¯ä¸ªåŠŸèƒ½ï¼Œè¿™æ ·èƒ½æ›´æ·±å…¥ç†è§£æ•´ä¸ªæµç¨‹ï¼