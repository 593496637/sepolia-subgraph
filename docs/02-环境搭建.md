# 🛠️ 环境搭建指南

> 🎯 本指南将帮助你从零开始搭建完整的 Web3 开发环境

## 📋 环境要求

### 必备软件

| 工具 | 版本要求 | 用途 | 安装说明 |
|------|----------|------|----------|
| **Node.js** | ≥ 18.0 | JavaScript 运行时 | [官网下载](https://nodejs.org/) |
| **pnpm** | ≥ 8.0 | 包管理器 | `npm install -g pnpm` |
| **Git** | ≥ 2.30 | 版本控制 | [官网下载](https://git-scm.com/) |
| **VS Code** | 最新版 | 代码编辑器 | [官网下载](https://code.visualstudio.com/) |

### 浏览器插件

| 插件 | 用途 | 安装链接 |
|------|------|----------|
| **MetaMask** | Web3 钱包 | [Chrome 商店](https://chrome.google.com/webstore/detail/metamask/) |
| **Apollo Client DevTools** | GraphQL 调试 | [Chrome 商店](https://chrome.google.com/webstore/detail/apollo-client-devtools/) |

## 🔧 详细安装步骤

### 1. Node.js 环境

#### macOS 安装
```bash
# 使用 Homebrew 安装
brew install node

# 或下载官方安装包
# 访问 https://nodejs.org/ 下载 LTS 版本
```

#### Windows 安装
```bash
# 方法 1: 直接下载安装包
# 访问 https://nodejs.org/ 下载 Windows 安装包

# 方法 2: 使用 Chocolatey
choco install nodejs

# 方法 3: 使用 Winget
winget install OpenJS.NodeJS
```

#### 验证安装
```bash
node --version  # 应输出 v18.x.x 或更高版本
npm --version   # 应输出对应的 npm 版本
```

### 2. pnpm 包管理器

#### 为什么选择 pnpm？
- 🚀 **更快的安装速度**: 硬链接和符号链接减少磁盘占用
- 💾 **节省磁盘空间**: 全局共享依赖包
- 🛡️ **更好的依赖管理**: 严格的依赖解析
- 🔧 **兼容 npm**: 支持所有 npm 命令

#### 安装 pnpm
```bash
# 方法 1: 使用 npm 安装（推荐）
npm install -g pnpm

# 方法 2: 使用官方脚本
curl -fsSL https://get.pnpm.io/install.sh | sh -

# 方法 3: 使用 Homebrew (macOS)
brew install pnpm
```

#### 验证安装
```bash
pnpm --version  # 应输出 8.x.x 或更高版本
```

### 3. VS Code 配置

#### 必装扩展
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "apollographql.vscode-apollo",
    "ms-vscode.vscode-eslint",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-json",
    "JuanBlanco.solidity"
  ]
}
```

#### VS Code 配置文件 (.vscode/settings.json)
```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "eslint.format.enable": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  }
}
```

## 🔗 区块链环境配置

### 1. MetaMask 钱包设置

#### 安装和初始化
1. **安装插件**: 从 Chrome 商店安装 MetaMask
2. **创建钱包**: 按照引导创建新钱包或导入现有钱包
3. **备份助记词**: ⚠️ 重要！安全保存 12 个单词的助记词

#### 添加 Sepolia 测试网
MetaMask 默认已包含 Sepolia 网络，如果没有请手动添加：

```javascript
// 网络配置信息
{
  "chainId": "0xaa36a7",  // 11155111 的十六进制
  "chainName": "Sepolia",
  "nativeCurrency": {
    "name": "SepoliaETH",
    "symbol": "ETH",
    "decimals": 18
  },
  "rpcUrls": [
    "https://sepolia.infura.io/v3/YOUR_INFURA_KEY",
    "https://ethereum-sepolia-rpc.publicnode.com"
  ],
  "blockExplorerUrls": ["https://sepolia.etherscan.io/"]
}
```

### 2. 获取测试 ETH

Sepolia 测试网需要测试 ETH 来支付 Gas 费用：

#### 推荐水龙头网站
1. **Sepolia Faucet** - https://sepoliafaucet.com/
2. **Alchemy Faucet** - https://sepoliafaucet.com/
3. **Infura Faucet** - https://www.infura.io/faucet/sepolia

#### 获取流程
1. 复制你的钱包地址
2. 访问水龙头网站
3. 粘贴地址并申请测试 ETH
4. 等待几分钟到账

### 3. RPC 节点配置

项目使用免费的公共 RPC 节点，也可以配置私有节点：

#### 免费公共节点
```typescript
// 当前使用的节点
const RPC_URLS = [
  'https://ethereum-sepolia-rpc.publicnode.com',
  'https://sepolia.gateway.tenderly.co',
  'https://rpc.sepolia.org'
]
```

#### 私有节点服务（可选）
- **Infura**: https://infura.io/
- **Alchemy**: https://www.alchemy.com/
- **QuickNode**: https://www.quicknode.com/

## 📁 项目初始化

### 1. 克隆项目
```bash
# 克隆仓库
git clone <your-repository-url>
cd sepoliaSubgraph

# 查看项目结构
ls -la
```

### 2. 安装前端依赖
```bash
cd frontend
pnpm install

# 查看已安装的包
pnpm list
```

### 3. 启动开发服务器
```bash
# 启动前端开发服务器
pnpm dev

# 开启新终端窗口，查看 linting
pnpm lint
```

### 4. 验证环境
访问 http://localhost:5173，你应该能看到：
- ✅ 页面正常加载
- ✅ 钱包连接按钮
- ✅ 交易查询界面
- ✅ 无控制台错误

## 🔍 故障排除

### 常见问题和解决方案

#### 1. Node.js 版本问题
```bash
# 问题: Node.js 版本过低
# 解决: 升级到最新 LTS 版本

# 使用 n (macOS/Linux)
npm install -g n
n lts

# 使用 nvm (跨平台)
nvm install --lts
nvm use --lts
```

#### 2. pnpm 安装失败
```bash
# 问题: pnpm 命令未找到
# 解决: 重新安装 pnpm

npm uninstall -g pnpm
npm install -g pnpm

# 或使用官方脚本
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

#### 3. MetaMask 连接问题
```bash
# 问题: MetaMask 无法连接
# 检查清单:
# ✅ 浏览器插件已启用
# ✅ 已切换到 Sepolia 网络
# ✅ 账户已解锁
# ✅ 网站已授权连接
```

#### 4. 端口占用问题
```bash
# 问题: 端口 5173 已被占用
# 解决: 查找并释放端口

# macOS/Linux
lsof -ti:5173 | xargs kill -9

# Windows
netstat -ano | findstr :5173
taskkill /PID <PID> /F
```

#### 5. 依赖安装问题
```bash
# 问题: 依赖安装失败
# 解决: 清理缓存重新安装

pnpm store prune  # 清理 pnpm 存储
rm -rf node_modules  # 删除 node_modules
rm pnpm-lock.yaml   # 删除锁定文件
pnpm install        # 重新安装
```

## ⚡ 性能优化建议

### 1. pnpm 配置优化
```bash
# .npmrc 文件配置
echo "store-dir=~/.pnpm-store" >> ~/.npmrc
echo "cache-dir=~/.pnpm-cache" >> ~/.npmrc
echo "state-dir=~/.pnpm-state" >> ~/.npmrc
```

### 2. VS Code 性能优化
```json
{
  "typescript.preferences.includePackageJsonAutoImports": "off",
  "typescript.suggest.autoImports": false,
  "search.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.git": true
  }
}
```

### 3. Git 配置优化
```bash
# 设置用户信息
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 优化性能
git config --global core.preloadindex true
git config --global core.fscache true
git config --global gc.auto 256
```

## 📊 环境验证清单

完成环境搭建后，请确认以下各项：

### 软件环境
- [ ] Node.js ≥ 18.0
- [ ] pnpm ≥ 8.0  
- [ ] Git 已配置
- [ ] VS Code 已安装推荐扩展

### 区块链环境
- [ ] MetaMask 已安装并初始化
- [ ] Sepolia 网络已添加
- [ ] 测试 ETH 已获取（≥ 0.1 ETH）
- [ ] 钱包地址已复制备用

### 项目环境
- [ ] 项目已克隆
- [ ] 依赖已安装（无错误）
- [ ] 开发服务器启动成功
- [ ] 页面正常访问
- [ ] 钱包可以正常连接

## 🎉 环境搭建完成！

恭喜！你已经完成了所有环境配置。现在你可以：

1. 🎨 **开发前端界面** - React + TypeScript 
2. 🔗 **集成 Web3 钱包** - MetaMask 连接
3. 📊 **查询区块链数据** - RPC + The Graph
4. 📜 **部署智能合约** - Sepolia 测试网

---

👉 **下一步**: [React 前端开发指南](./03-React前端开发.md)

💡 **小贴士**: 遇到问题时，优先检查控制台错误信息，大多数问题都能通过错误提示快速定位！